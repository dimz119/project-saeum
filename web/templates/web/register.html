{% extends 'web/base.html' %}
{% load static %}

{% block title %}회원가입 - MonthlyLook{% endblock %}

{% block content %}
<div id="header-root"></div>
<div id="register-root"></div>
<div id="footer-root"></div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'web/src/components/RegisterForm.js' %}"></script>
<script>
    // 회원가입 페이지 렌더링
    document.addEventListener('DOMContentLoaded', function() {
        let attempts = 0;
        const maxAttempts = 20;
        
        const renderRegisterPage = () => {
            attempts++;
            console.log(`Register page render attempt ${attempts}/${maxAttempts}`);
            
            // 필요한 컴포넌트들이 로드되었는지 확인
            if (window.Components && window.Components.Header && window.Components.Footer && 
                window.RegisterForm && window.i18n && window.AuthProvider) {
                
                console.log('Rendering register page with header and footer');
                
                // 모든 컴포넌트를 하나의 AuthProvider로 감싸서 렌더링
                const headerRoot = document.getElementById('header-root');
                const registerRoot = document.getElementById('register-root'); 
                const footerRoot = document.getElementById('footer-root');
                
                // 언어 변경 리렌더링 함수
                const renderComponents = () => {
                    if (headerRoot) {
                        ReactDOM.render(
                            React.createElement(window.Components.Header),
                            headerRoot
                        );
                    }
                    
                    if (registerRoot) {
                        ReactDOM.render(
                            React.createElement(window.RegisterForm),
                            registerRoot
                        );
                    }
                    
                    if (footerRoot) {
                        ReactDOM.render(
                            React.createElement(window.Components.Footer),
                            footerRoot
                        );
                    }
                };
                
                // 초기 렌더링
                renderComponents();
                
                // 언어 변경 이벤트 리스너 추가
                if (window.i18n) {
                    window.i18n.addLanguageChangeListener(() => {
                        console.log('Language changed, re-rendering register page components');
                        setTimeout(renderComponents, 100);
                    });
                }
                
                console.log('Register page components successfully rendered');
            } else if (attempts < maxAttempts) {
                console.log('Components not ready, retrying...');
                setTimeout(renderRegisterPage, 100);
            } else {
                console.error('Failed to load register page components after maximum attempts');
                const registerRoot = document.getElementById('register-root');
                if (registerRoot) {
                    registerRoot.innerHTML = '<div style="padding: 20px; text-align: center; color: red;"><h2>로딩 실패</h2><p>페이지를 새로고침해주세요.</p></div>';
                }
            }
        };
        
        // 약간의 지연 후 렌더링 시작
        setTimeout(renderRegisterPage, 300);
    });
</script>
{% endblock %}
